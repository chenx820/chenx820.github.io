# 优化后的部署脚本说明

## 新功能

### 1. Git LFS 支持

- 自动设置Git LFS来跟踪大文件（PDF、图片、视频等）
- 支持的文件类型：`*.pdf`, `*.jpg`, `*.jpeg`, `*.png`, `*.gif`, `*.mp4`, `*.mov`
- 大文件通过Git LFS存储，避免GitHub仓库过大

### 2. 增量部署

- 只更新有变化的文件，避免重复上传
- 保留部署目录用于后续增量更新
- 智能检测文件变化

### 3. 命令行选项

```bash
./deploy.sh              # 默认：增量部署
./deploy.sh --clean      # 清理部署目录，重新部署
./deploy.sh --setup      # 仅设置Git LFS
./deploy.sh --help       # 显示帮助信息
```

## 使用方法

### 首次部署

```bash
./deploy.sh --clean
```

### 日常更新

```bash
./deploy.sh
```

### 仅设置Git LFS

```bash
./deploy.sh --setup
```

## 优化效果

### 文件大小优化

- **原始大小**：~859MB
- **优化后**：~437MB（减少约46%）
- **大文件处理**：通过Git LFS管理，避免重复上传

### 部署速度优化

- **增量部署**：只上传变化的文件
- **智能检测**：自动识别需要更新的内容
- **缓存机制**：保留部署目录，加速后续部署

## 技术细节

### Git LFS 配置

- 自动跟踪大文件类型
- 配置文件：`.gitattributes`
- 支持的文件大小：>10MB

### 增量部署逻辑

1. 检查现有部署目录
2. 比较文件变化
3. 只更新修改的文件
4. 保持大文件引用

### 错误处理

- 网络超时重试
- 自动回退到完整部署
- 详细的错误信息

## 注意事项

1. **首次使用**：建议使用 `--clean` 选项进行完整部署
2. **网络问题**：如果遇到网络超时，脚本会自动重试
3. **大文件**：超过50MB的文件会被自动处理
4. **Git LFS**：确保Git LFS已正确安装和配置

## 故障排除

### 如果遇到网络超时

```bash
./deploy.sh --clean
```

### 如果Git LFS未安装

```bash
# macOS
brew install git-lfs

# 或手动安装
# https://git-lfs.github.io/
```

### 如果部署目录损坏

```bash
rm -rf .deploy-gh
./deploy.sh --clean
```

## 性能对比

| 部署方式 | 文件大小 | 部署时间 | 网络使用 |
| -------- | -------- | -------- | -------- |
| 原始方式 | 859MB    | 长       | 高       |
| 优化后   | 437MB    | 短       | 低       |
| 增量部署 | 变化文件 | 极短     | 极低     |
